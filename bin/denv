#!/bin/bash

# generate shuk test env container

mode=$1


cmdinfo(){
    echo "docker run [--priviledged for all capibility] -d [-it for /bin/bash] --name -h --mac-address image_name [cmd]";
    echo ""
}

stop_by_name(){
    
    while  
        docker ps --format="{{.Names}}" | awk '{print NR ": " $0}' && \
        echo "[ Docker enter container name to stop ]( ctrl+c to exit ):" && \
        read number && [ "$number" != "N" ]
    do
        local rm_name=$(docker stop `docker ps --format="{{.Names}}" | awk NR==$number`)
        echo "$rm_name stoped"
    done
    
}

rm_by_name(){
    
    while 
        docker ps -a --format="{{.Names}}" -f="status=exited" -f="status=created" | awk '{print NR ": " $0}' && \
        echo "[ Docker enter number to rm container ]( ctrl+c to exit ):" && \
        read number && [ "$number" != "N" ]
    do
        local rm_name=$(docker rm `docker ps -a --format="{{.Names}}" -f="status=exited" -f="status=created" | awk NR==$number`)
        echo "$rm_name removed"
    done
    
}

rmi_none(){
    docker rmi -f `docker images |grep ^\<none\> | awk '{print $3}'`   
}

create_prompt(){
    # show docker image list
    docker images && echo ""
    cmdinfo

##
## must
##
    echo "[Docker images]:"
    read image_name
    [ -z $image_name ] && echo "please input docker image name..." && exit 1

    # enter docker container name
    echo "[Docker container nane and hostname]:"
    read container_name
    [ -z $container_name ] && echo "please input container name..." && exit 1
    container_name="--name $container_name -h $container_name "

##
## optional
## 

    # mac address
    echo "[Docker mac address](empty for auto generated):"
    read mac_addr
    [ -z $mac_addr ] || mac_addr="--mac-address $mac_address"

    # port binding
    echo "[Docker port binding with host]:"
    read port_binding
    [ -z $port_binding ] || port_binding="-p $port_binding"

    # cmd
    echo "[Docker cmd](empty for dockerfile default cmd):"
    read cmd

    # privileged
    echo "Do you want to active privileged with container(Y/N)?"
    read privileged 
    [ "$privileged" != "Y" ] &&  privilege=""

    container_id=$(docker run -d $priviledged $port_binding $container_name $mac_addr $image_name $cmd)
    echo "Container ID   is : $container_id"
    echo "Container name is : $container_name"
}


case $mode in
rm_by_name)
    rm_by_name
;;
stop_by_name)
    stop_by_name
;;
rmi_none)
    rm_none
;;
create_prompt)
    create_prompt;
;;
enter)
    docker ps
    echo "[Dodcker please choose container name to operate]:"
    read cname
    docker exec -it $cname /bin/bash
    exit 0
;;
cmdinfo)
    cmdinfo
;;
psinfo)
    docker-psinfo "${@:2}";
;;
update_dhcp)
    update_dhcp "${@:2}";
;;
*)
    docker "$@"
;;

esac


