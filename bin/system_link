#!/bin/bash
# Script to recreate symbolic links in config/ directory
# Generated on 2026-02-07

set -e

# Color output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}Recreating symbolic links in config/ directory...${NC}"

# Create config directory if it doesn't exist
mkdir -p "${HOME}"/projects/env_setup/config

# Symbolic links to recreate
declare -a SYMLINKS=(
    # Global system configurations
    "/etc/fstab:${HOME}/projects/env_setup/config/fstab"
    "/etc/group:${HOME}/projects/env_setup/config/group"
    "/etc/hostname:${HOME}/projects/env_setup/config/hostname"
    "/etc/hosts:${HOME}/projects/env_setup/config/hosts"
    "/etc/localtime:${HOME}/projects/env_setup/config/localtime"
    "/etc/ssl/openssl.cnf:${HOME}/projects/env_setup/config/openssl.cnf"
    "/etc/passwd:${HOME}/projects/env_setup/config/passwd"
    "/etc/sysctl.conf:${HOME}/projects/env_setup/config/sysctl.conf"
    "/var/log/auth.log:${HOME}/projects/env_setup/config/auth.log"

    # User home directory configurations
    "${HOME}/.bash_plugin:${HOME}/projects/env_setup/config/.bash_plugin"
    "${HOME}/.colima:${HOME}/projects/env_setup/config/.colima"
    "${HOME}/.config:${HOME}/projects/env_setup/config/.config"
    "${HOME}/.gemini:${HOME}/projects/env_setup/config/.gemini"
    "${HOME}/.screenrc:${HOME}/projects/env_setup/config/.screenrc"
    "${HOME}/.ssh:${HOME}/projects/env_setup/config/.ssh"
    "${HOME}/.vscode:${HOME}/projects/env_setup/config/.vscode"
    "${HOME}/lib:${HOME}/projects/env_setup/config/lib"
)

# Create each symbolic link
for link_pair in "${SYMLINKS[@]}"; do
    IFS=':' read -r source_path target_path <<<"$link_pair"

    # Remove existing symlink if it exists
    if [ -L "$target_path" ]; then
        echo -e "${BLUE}Removing existing symlink: $target_path${NC}"
        rm "$target_path"
    elif [ -e "$target_path" ]; then
        echo -e "${BLUE}Warning: $target_path exists but is not a symlink. Skipping...${NC}"
        continue
    fi

    # Create the symbolic link
    echo -e "${GREEN}Creating symlink: $source_path -> $target_path${NC}"
    ln -s "$source_path" "$target_path"
done

# VS Code User Configurations
# Ref: bin/vscode/README.md
echo -e "${BLUE}Applying VS Code user configurations...${NC}"

case "$OSTYPE" in
    darwin*) VSCODE_USER_DIR="${HOME}/Library/Application Support/Code/User" ;;
    linux*)  VSCODE_USER_DIR="${HOME}/.config/Code/User" ;;
    *)       VSCODE_USER_DIR="${HOME}/.config/Code/User" ;;
esac

# Remove existing snippets directory if it's not a symlink to allow symlinking
if [ -d "$VSCODE_USER_DIR/snippets" ] && [ ! -L "$VSCODE_USER_DIR/snippets" ]; then
    rm -rf "$VSCODE_USER_DIR/snippets"
fi


if [ -n "$VSCODE_USER_DIR" ]; then
    mkdir -p "$VSCODE_USER_DIR"
    for item in "settings.json" "keybindings.json" "snippets"; do
        source_path="${HOME}/projects/env_setup/bin/vscode/$item"
        target_path="$VSCODE_USER_DIR/$item"

        if [ -e "$source_path" ]; then
            if [ -L "$target_path" ]; then
                rm "$target_path"
            elif [ -e "$target_path" ]; then
                echo -e "${BLUE}Warning: $target_path exists but is not a symlink. Skipping...${NC}"
                continue
            fi
            echo -e "${GREEN}Creating symlink: $source_path -> $target_path${NC}"
            ln -s "$source_path" "$target_path"
        fi
    done
fi

echo -e "${GREEN}All symbolic links have been recreated successfully!${NC}"



